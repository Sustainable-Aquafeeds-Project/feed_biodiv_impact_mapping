---
title: "Aquaculture diet composition wrangling"
output: html_document
editor_options: 
  chunk_output_type: console
---

Wrangling and aggragating some aquaculture diet composition data.

```{r}
source(here("src/fxns.R"))

library(tidyverse)
library(readxl)

regions <- read_csv(here("data/spatial/output/food_rgns.csv")) %>%
  select(iso3c) %>%
  unique()

# Halley diet data
diet <- read_excel(here("prep/02_feed/diet_composition_wrangling/Final_DietCrop_Numbers.xlsx"), sheet = "% type of crop input")

test <- read.csv(here("prep/02_feed/diet_composition_wrangling/salmon_aquaculture_diet_composition.csv"))

```

Salmon: diet from Aas source, global values used for regions

### salmon

```{r}

salmon <- read_xlsx(here("prep/02_feed/diet_composition_wrangling/salmon_aquaculture_diet_composition.xlsx"), sheet = "2020") %>%
  mutate(raw_name = ifelse(raw_name == "camelina oil", "rapeseed and camelina oil", raw_name),
         raw_name = ifelse(raw_name == "rapeseed oil", "rapeseed and camelina oil", raw_name)) %>%
  group_by(species, production_system, raw_name) %>%
  summarise(per_diet = sum(per_diet, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(prop_diet = per_diet * 0.01) %>%
  merge(regions) %>%
  select(iso3c, raw_name, prop_diet, production_system, species) 

write.csv(salmon, here("prep/02_feed/data/aquaculture_diet_composition.csv"), row.names = FALSE)


```
